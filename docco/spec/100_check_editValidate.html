<!DOCTYPE html>

<html>
<head>
  <title>config</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="..\docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="000_globals.html">
                  spec/000_globals.litcoffee
                </a>
              
                
                <a class="source" href="001_globals_sameStructure.html">
                  spec/001_globals_sameStructure.litcoffee
                </a>
              
                
                <a class="source" href="002_utils_checkItemName.html">
                  spec/002_utils_checkItemName.litcoffee
                </a>
              
                
                <a class="source" href="003_utils_prettyPrint.html">
                  spec/003_utils_prettyPrint.litcoffee
                </a>
              
                
                <a class="source" href="004_utils_deepClone.html">
                  spec/004_utils_deepClone.litcoffee
                </a>
              
                
                <a class="source" href="006_sortedMap.html">
                  spec/006_sortedMap.litcoffee
                </a>
              
                
                <a class="source" href="007_flatMap.html">
                  spec/007_flatMap.litcoffee
                </a>
              
                
                <a class="source" href="008_bitArray.html">
                  spec/008_bitArray.litcoffee
                </a>
              
                
                <a class="source" href="009_flatMap_masks.html">
                  spec/009_flatMap_masks.litcoffee
                </a>
              
                
                <a class="source" href="010_result.html">
                  spec/010_result.litcoffee
                </a>
              
                
                <a class="source" href="012_result_path.html">
                  spec/012_result_path.litcoffee
                </a>
              
                
                <a class="source" href="015_i18n.html">
                  spec/015_i18n.litcoffee
                </a>
              
                
                <a class="source" href="020_reporter.html">
                  spec/020_reporter.litcoffee
                </a>
              
                
                <a class="source" href="030_loader.html">
                  spec/030_loader.litcoffee
                </a>
              
                
                <a class="source" href="040_types.html">
                  spec/040_types.litcoffee
                </a>
              
                
                <a class="source" href="041_validate.html">
                  spec/041_validate.litcoffee
                </a>
              
                
                <a class="source" href="042_tags_compile.html">
                  spec/042_tags_compile.litcoffee
                </a>
              
                
                <a class="source" href="044_tags_namespace.html">
                  spec/044_tags_namespace.litcoffee
                </a>
              
                
                <a class="source" href="046_tags_calc.html">
                  spec/046_tags_calc.litcoffee
                </a>
              
                
                <a class="source" href="048_tags_calc_tokenizer.html">
                  spec/048_tags_calc_tokenizer.litcoffee
                </a>
              
                
                <a class="source" href="050_config_udtypes.html">
                  spec/050_config_udtypes.litcoffee
                </a>
              
                
                <a class="source" href="051_config_udtypes_extraProps.html">
                  spec/051_config_udtypes_extraProps.litcoffee
                </a>
              
                
                <a class="source" href="060_config_fields.html">
                  spec/060_config_fields.litcoffee
                </a>
              
                
                <a class="source" href="062_config_actions.html">
                  spec/062_config_actions.litcoffee
                </a>
              
                
                <a class="source" href="064_config_states.html">
                  spec/064_config_states.litcoffee
                </a>
              
                
                <a class="source" href="070_config.html">
                  spec/070_config.litcoffee
                </a>
              
                
                <a class="source" href="071_config_helpers.html">
                  spec/071_config_helpers.litcoffee
                </a>
              
                
                <a class="source" href="072_config_helpers_edit.html">
                  spec/072_config_helpers_edit.litcoffee
                </a>
              
                
                <a class="source" href="073_config_system_fields_and_actions.html">
                  spec/073_config_system_fields_and_actions.litcoffee
                </a>
              
                
                <a class="source" href="074_config_fields_custom_validate.html">
                  spec/074_config_fields_custom_validate.litcoffee
                </a>
              
                
                <a class="source" href="100_check_editValidate.html">
                  spec/100_check_editValidate.litcoffee
                </a>
              
                
                <a class="source" href="90_vueDebugWatchBuilder.html">
                  spec/90_vueDebugWatchBuilder.litcoffee
                </a>
              
                
                <a class="source" href="_helpers\DSScopeStub.html">
                  spec/_helpers/DSScopeStub.litcoffee
                </a>
              
                
                <a class="source" href="_helpers\SpecSteps.html">
                  spec/_helpers/SpecSteps.litcoffee
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="config">config</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>{Result,
config: {compile: compileConfig, link: linkConfig, unlink: unlinkConfig},
utils: {deepClone, prettyPrint}} = <span class="hljs-built_in">require</span> <span class="hljs-string">'../src'</span>

processCustomValidate = <span class="hljs-built_in">require</span> <span class="hljs-string">'../src/validate/processCustomValidate'</span>

focusOnCheck = <span class="hljs-string">''</span>
<span class="hljs-function"><span class="hljs-title">check</span> = <span class="hljs-params">(itName, itBody)</span> -&gt;</span> (<span class="hljs-keyword">if</span> focusOnCheck == itName <span class="hljs-keyword">then</span> fit <span class="hljs-keyword">else</span> it) itName, itBody; <span class="hljs-keyword">return</span>

describe <span class="hljs-string">'100_check_editValidate'</span>, <span class="hljs-function">-&gt;</span>

  check <span class="hljs-string">'general'</span>, <span class="hljs-function">-&gt;</span>

    res = compileConfig (result = <span class="hljs-keyword">new</span> Result),
      udtypes:
        <span class="hljs-string">'traskoCrm.photo'</span>:
          extra: {
            name1C: <span class="hljs-string">'Photo'</span>
          },
          type: <span class="hljs-string">'text'</span>
        <span class="hljs-string">'traskoCrm.id1C'</span>:
          extra:
            name1C: <span class="hljs-string">'ID_1C'</span>
            label: <span class="hljs-string">'1С ID'</span>
            description: <span class="hljs-string">'Обязательный. Идентификатор учетной записи сайта в 1С. Параметр,\nприсваиваемый автоматически внутри 1С вида:\nb0d4ce5d-2757-4699-948c-cfa72ba94f86'</span>
          type: <span class="hljs-string">'string'</span>
          length: <span class="hljs-number">36</span>
        <span class="hljs-string">'trascoCrm.priorityCommunicationChannel'</span>:
          extra: {
            name1C: <span class="hljs-string">'PriorityCommunicationChannel'</span>,
            label: <span class="hljs-string">'Приоритетный канал связи'</span>,
            description: <span class="hljs-string">'
              Телефон
              АдресЭлектроннойПочты
            '</span>
          },
          type: <span class="hljs-string">'enum'</span>,
          enum: [{
            name: <span class="hljs-string">'email'</span>,
            extra: {
              value1C: <span class="hljs-string">'АдресЭлектроннойПочты'</span>,
              label: <span class="hljs-string">'Email'</span>,
              labelEn: <span class="hljs-string">'Email'</span>
            }
          }, {
            name: <span class="hljs-string">'phone'</span>,
            extra: {
              value1C: <span class="hljs-string">'Телефон'</span>,
              label: <span class="hljs-string">'Телефон'</span>,
              labelEn: <span class="hljs-string">'Phone'</span>
            }
          }]
        phone:
          type: <span class="hljs-string">'string'</span>
          length: <span class="hljs-number">15</span>
          regexp: <span class="hljs-regexp">/^\+?[\s\d\(\)-]*$/</span>
        email:
          type: <span class="hljs-string">'string'</span>
          length: <span class="hljs-number">320</span>
          regexp: <span class="hljs-regexp">/^((?:[a-z0-9!#$%&amp;'*+/</span>=?^_<span class="hljs-string">'{|}~-]+(?:\.[a-z0-9!#$%&amp;'</span>*+<span class="hljs-regexp">/=?^_'{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]))?$/i</span>
      docs: Contact:
        extra: {
          label: <span class="hljs-string">'Контакт'</span>,
          labelEn: <span class="hljs-string">'Contact'</span>
        },
        fields: {
          contactPersonId: {
            extra: {
              name1C: <span class="hljs-string">'ContactPersonId'</span>,
              label: <span class="hljs-string">'Идентификатор контактного лица'</span>,
              description: <span class="hljs-string">'Обязательный. Идентификатор контактного лица в 1С. Параметр, присваиваемый автоматически внутри 1С вида:\nb0d4ce5d-2757-4699-948c-cfa72ba94f86'</span>
            },
            type: <span class="hljs-string">'traskoCrm.id1C'</span>
          },</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <pre><code>         photo: {
           extra: {
             name1C: <span class="hljs-string">'Photo'</span>,
             label: <span class="hljs-string">'Фото'</span>,
             description: <span class="hljs-string">'Файл с фотографией, передаваемый в форме двоичных данных'</span>
           },
           tags: <span class="hljs-string">'ui.cardSection1, ui.newContactPerson'</span>,
           type: <span class="hljs-string">'traskoCrm.photo'</span>,
           validate: <span class="hljs-string">'base64FileSize(3)'</span>,
           null: <span class="hljs-literal">true</span>
         },</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>          contactName: {
            extra: {
              name1C: <span class="hljs-string">'ContactName'</span>,
              label: <span class="hljs-string">'ФИО'</span>,
              description: <span class="hljs-string">'Обязательный. Фамилия. Имя, Отчество пользователя, оформляющего обращение.\nДля обращений, создаваемых из личного кабинета заполняется автоматически на основании учетных данных (может быть скорректирован). В остальных случаях задается вручную'</span>
            },
            tags: <span class="hljs-string">'ui.cardSection1'</span>,
            type: <span class="hljs-string">'string(4096)'</span>,
            required: <span class="hljs-literal">true</span>
          },
          email: {
            extra: {
              name1C: <span class="hljs-string">'Email'</span>,
              label: <span class="hljs-string">'Адрес электронной почты'</span>,
              description: <span class="hljs-string">'Обязательный. Электронная почта на форме обращения.'</span>
            },
            tags: <span class="hljs-string">'ui.cardSection1'</span>,
            type: <span class="hljs-string">'email'</span>,
            required: <span class="hljs-literal">true</span>
          },
          phone: {
            extra: {
              name1C: <span class="hljs-string">'Phone'</span>,
              label: <span class="hljs-string">'Телефон'</span>,
              description: <span class="hljs-string">'Номер телефона в формате: 7 (968) 342-12-67'</span>
            },
            tags: <span class="hljs-string">'ui.cardSection1'</span>,
            type: <span class="hljs-string">'phone'</span>
          },
          mobile: {
            extra: {
              name1C: <span class="hljs-string">'Mobile'</span>,
              label: <span class="hljs-string">'Мобильный телефон'</span>,
              description: <span class="hljs-string">'Номер телефона в формате: 7 (968) 342-12-67'</span>
            },
            tags: <span class="hljs-string">'ui.cardSection1'</span>,
            type: <span class="hljs-string">'phone'</span>
          },
          position: {
            extra: {
              name1C: <span class="hljs-string">'Position'</span>,
              label: <span class="hljs-string">'Должность'</span>,
              description: <span class="hljs-string">''</span>
            },
            tags: <span class="hljs-string">'ui.cardSection1'</span>,
            type: <span class="hljs-string">'string(4096)'</span>
          },
          priorityCommunicationChannel: {
            extra: {
              name1C: <span class="hljs-string">'PriorityCommunicationChannel'</span>,
              label: <span class="hljs-string">'Приоритетный канал связи'</span>,
              description: <span class="hljs-string">'Выпадающий список: Телефон, Email, Соцсеть'</span>
            },
            tags: <span class="hljs-string">'ui.cardSection1'</span>,
            null: <span class="hljs-literal">false</span>,
            init: <span class="hljs-string">'phone'</span>,
            type: <span class="hljs-string">'trascoCrm.priorityCommunicationChannel'</span>,
          },
          photoExtension: {
            extra: {
              name1C: <span class="hljs-string">'PhotoExtension'</span>,
              label: <span class="hljs-string">'Расширение файла c фотографией'</span>,
              description: <span class="hljs-string">'Расширение файла с фотографией для подсказки браузеру. Например “jpg”, “png”'</span>
            },
            type: <span class="hljs-string">'string(4096)'</span>,
            null: <span class="hljs-literal">true</span>
          }
        }

    expect(result.messages).toEqual []

    unlinkedConfig = unlinkConfig res

    linkedConfig = linkConfig unlinkedConfig

    validate = linkedConfig.docs[<span class="hljs-string">'doc.Contact'</span>].$$editValidateBuilder()

    res = validate {
      contactPersonId: <span class="hljs-string">"5a1a26a8-cb3d-11ea-8184-00155d0a5000"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>photo: null,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      contactName: <span class="hljs-string">"Анна Князева"</span>
      email: <span class="hljs-string">"knyazeva"</span>
      phone: <span class="hljs-string">"222"</span>
      mobile: <span class="hljs-string">"333"</span>
      position: <span class="hljs-string">"222"</span>
      priorityCommunicationChannel: <span class="hljs-string">"email"</span>
      photoExtension: <span class="hljs-literal">null</span>
      $$touched:
        priorityCommunicationChannel: <span class="hljs-literal">true</span>
        email: <span class="hljs-literal">true</span>
    }, beforeSubmit: <span class="hljs-literal">false</span>

    expect(res).toEqual
      save: <span class="hljs-literal">false</span>
      submit: <span class="hljs-literal">false</span>
      messages:
        email:
          type: <span class="hljs-string">'error'</span>
          path: <span class="hljs-string">'email'</span>
          code: <span class="hljs-string">'validate.invalidValue'</span>
          value: <span class="hljs-string">'knyazeva'</span>
          regexp: <span class="hljs-regexp">/^((?:[a-z0-9!#$%&amp;'*+/</span>=?^_<span class="hljs-string">'{|}~-]+(?:\.[a-z0-9!#$%&amp;'</span>*+<span class="hljs-regexp">/=?^_'{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]))?$/i</span>.toString()

    res = validate {
      contactPersonId: <span class="hljs-string">"5a1a26a8-cb3d-11ea-8184-00155d0a5000"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>photo: null,</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      contactName: <span class="hljs-string">"Анна Князева"</span>
      email: <span class="hljs-string">"knyazeva2"</span>
      phone: <span class="hljs-string">"222"</span>
      mobile: <span class="hljs-string">"333"</span>
      position: <span class="hljs-string">"222"</span>
      priorityCommunicationChannel: <span class="hljs-string">"email"</span>
      photoExtension: <span class="hljs-literal">null</span>
      $$touched:
        priorityCommunicationChannel: <span class="hljs-literal">true</span>
        email: <span class="hljs-literal">true</span>
    }, beforeSubmit: <span class="hljs-literal">false</span>

    expect(res).toEqual
      save: <span class="hljs-literal">false</span>
      submit: <span class="hljs-literal">false</span>
      messages:
        email:
          type: <span class="hljs-string">'error'</span>
          path: <span class="hljs-string">'email'</span>
          code: <span class="hljs-string">'validate.invalidValue'</span>
          value: <span class="hljs-string">'knyazeva2'</span>
          regexp: <span class="hljs-regexp">/^((?:[a-z0-9!#$%&amp;'*+/</span>=?^_<span class="hljs-string">'{|}~-]+(?:\.[a-z0-9!#$%&amp;'</span>*+<span class="hljs-regexp">/=?^_'{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]))?$/i</span>.toString()</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
